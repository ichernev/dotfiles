#!/bin/bash

if [ -t 1 ]; then
    # ttys deserve some spice
    color="--color"
fi
got_location=0
declare -a nargs
nargs=()
for opt in "$@"; do
  if [ -d "$opt" -o -f "$opt" ]; then
    got_location=1
  fi
  nopt=
  case "$opt" in
    ddb)
      nopt="Documentation/devicetree/bindings"
      got_location=1
      ;;
    adts)
      nopt="arch/arm/boot/dts"
      got_location=1
      ;;
    a64dts)
      nopt="arch/arm64/boot/dts"
      got_location=1
      ;;
    *)
      nopt="$opt"
      ;;
  esac
  nargs+=("$nopt")
done
if [ $got_location -eq 0 ]; then
  nargs+=(".")
fi
set -- "${nargs[@]}"

# extended regex
# ignore binary files
# show line numbers
# recursive
exec grep -EInrs "$@" $color \
    --exclude-dir='.git' \
    --exclude-dir='.svn' \
    --exclude='tags' \
    --exclude='cscope.out' \
    --exclude-dir='.hg' \
    --exclude-dir='build' \
    --exclude-dir='node_modules' \
    --exclude-dir='bower_components' \
    --exclude-dir='.output*'
